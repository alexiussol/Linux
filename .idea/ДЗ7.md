1. Подключить репозиторий с nginx любым удобным способом, установить nginx и потом удалить nginx, используя утилиту dpkg.
2. Установить пакет на свой выбор, используя snap.
3. Настроить iptables: разрешить подключения только на 22-й и 80-й порты.
4. * Настроить проброс портов локально с порта 80 на порт 8080.

alexei@alexei-VirtualBox:~$ lsb_release -a

No LSB modules are available.

Distributor ID:	Ubuntu

Description:	Ubuntu 22.04 LTS

Release:	22.04

Codename:	jammy

alexei@alexei-VirtualBox:~$ apt download dpkg

Пол:1 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 dpkg amd64 1.21.1ubuntu2.1 [1 239 kB]

Получено 1 239 kB за 1с (1 507 kB/s)  

alexei@alexei-VirtualBox:~$ sudo nano /etc/apt/sources.list

alexei@alexei-VirtualBox:~$ sudo apt-get update

Сущ:1 http://ru.archive.ubuntu.com/ubuntu jammy InRelease

Пол:2 http://ru.archive.ubuntu.com/ubuntu jammy-updates InRelease [114 kB]

Пол:3 http://security.ubuntu.com/ubuntu jammy-security InRelease [110 kB]                                             

Пол:4 http://ru.archive.ubuntu.com/ubuntu jammy-backports InRelease [99,8 kB]                                         

Пол:5 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [502 kB]                            

Пол:6 http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages [266 kB]                   

Игн:7 https://nginx.org/packages/mainline/debian jammy InRelease                                                    

Ошб:8 https://nginx.org/packages/mainline/debian jammy Release                                                                     

  404  Not Found [IP: 3.125.197.172 443]

Пол:9 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main i386 Packages [269 kB]                                                

Пол:10 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [119 kB]            

Пол:11 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 DEP-11 Metadata [91,5 kB]       

Пол:12 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main DEP-11 48x48 Icons [26,2 kB]                  

Пол:13 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main DEP-11 64x64 Icons [38,2 kB]                

Пол:14 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [7 116 B]              

Пол:15 http://ru.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [276 kB]                   

Пол:16 http://security.ubuntu.com/ubuntu jammy-security/main i386 Packages [96,2 kB]                          

Пол:17 http://security.ubuntu.com/ubuntu jammy-security/main Translation-en [63,5 kB]                

Пол:18 http://ru.archive.ubuntu.com/ubuntu jammy-updates/restricted i386 Packages [22,1 kB]   

Пол:19 http://ru.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [42,5 kB]    

Пол:20 http://ru.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 c-n-f Metadata [524 B]      

Пол:21 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [210 kB]           

Пол:22 http://security.ubuntu.com/ubuntu jammy-security/main amd64 DEP-11 Metadata [11,4 kB]       

Пол:23 http://security.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [3 924 B]           

Пол:24 http://security.ubuntu.com/ubuntu jammy-security/restricted i386 Packages [21,8 kB]             

Пол:25 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [243 kB]             

Пол:26 http://security.ubuntu.com/ubuntu jammy-security/restricted Translation-en [37,3 kB]         

Пол:27 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 c-n-f Metadata [524 B]

Пол:28 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [107 kB]    

Пол:29 http://security.ubuntu.com/ubuntu jammy-security/universe i386 Packages [55,3 kB]

Пол:30 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe i386 Packages [113 kB]           

Пол:31 http://security.ubuntu.com/ubuntu jammy-security/universe Translation-en [36,9 kB]            

Пол:32 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 DEP-11 Metadata [10,1 kB]     

Пол:33 http://security.ubuntu.com/ubuntu jammy-security/universe DEP-11 48x48 Icons [1 977 B]            

Пол:34 http://security.ubuntu.com/ubuntu jammy-security/universe DEP-11 64x64 Icons [2 587 B]       

Пол:35 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [2 408 B]     

Пол:36 http://security.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [4 192 B]               

Пол:37 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [69,8 kB]                 

Пол:38 http://security.ubuntu.com/ubuntu jammy-security/multiverse i386 Packages [1 024 B]                  

Пол:39 http://security.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [228 B]            

Пол:40 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 DEP-11 Metadata [127 kB]

Пол:41 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe DEP-11 48x48 Icons [42,6 kB]

Пол:42 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe DEP-11 64x64 Icons [57,2 kB]

Пол:43 http://ru.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [4 404 B]

Пол:44 http://ru.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [7 000 B]

Пол:45 http://ru.archive.ubuntu.com/ubuntu jammy-updates/multiverse i386 Packages [1 432 B]

Пол:46 http://ru.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [2 264 B]

Пол:47 http://ru.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 DEP-11 Metadata [940 B]

Пол:48 http://ru.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [420 B]

Пол:49 http://ru.archive.ubuntu.com/ubuntu jammy-backports/universe i386 Packages [3 844 B]

Пол:50 http://ru.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [5 416 B]

Пол:51 http://ru.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [8 248 B]

Пол:52 http://ru.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 DEP-11 Metadata [12,5 kB]

Пол:53 http://ru.archive.ubuntu.com/ubuntu jammy-backports/universe DEP-11 64x64 Icons [7 651 B]

Пол:54 http://ru.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [236 B]

Чтение списков пакетов… Готово                                     

E: Репозиторий «https://nginx.org/packages/mainline/debian jammy Release» не содержит файла Release.

N: Обновление из этого репозитория нельзя выполнить безопасным способом, поэтому по умолчанию он отключён.

N: Информацию о создании репозитория и настройках пользователя смотрите в справочной странице apt-secure(8).

alexei@alexei-VirtualBox:~$ sudo apt-get install nginx

Чтение списков пакетов… Готово

Построение дерева зависимостей… Готово

Чтение информации о состоянии… Готово         

Будут установлены следующие дополнительные пакеты:

  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream

  libnginx-mod-stream-geoip2 nginx-common nginx-core

Предлагаемые пакеты:

  fcgiwrap nginx-doc

Следующие НОВЫЕ пакеты будут установлены:

  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream

  libnginx-mod-stream-geoip2 nginx nginx-common nginx-core

Обновлено 0 пакетов, установлено 9 новых пакетов, для удаления отмечено 0 пакетов, и 286 пакетов не обновлено.

Необходимо скачать 696 kB архивов.

После данной операции объём занятого дискового пространства возрастёт на 2 395 kB.

Хотите продолжить? [Д/н] д

Пол:1 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 nginx-common all 1.18.0-6ubuntu14.1 [40,1 kB]

Пол:2 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnginx-mod-http-geoip2 amd64 1.18.0-6ubuntu14.1 [11,9 kB]

Пол:3 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnginx-mod-http-image-filter amd64 1.18.0-6ubuntu14.1 [15,4 kB]

Пол:4 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnginx-mod-http-xslt-filter amd64 1.18.0-6ubuntu14.1 [13,8 kB]

Пол:5 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnginx-mod-mail amd64 1.18.0-6ubuntu14.1 [45,7 kB]

Пол:6 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnginx-mod-stream amd64 1.18.0-6ubuntu14.1 [72,9 kB]

Пол:7 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnginx-mod-stream-geoip2 amd64 1.18.0-6ubuntu14.1 [10,1 kB]

Пол:8 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 nginx-core amd64 1.18.0-6ubuntu14.1 [482 kB]

Пол:9 http://ru.archive.ubuntu.com/ubuntu jammy-updates/main amd64 nginx amd64 1.18.0-6ubuntu14.1 [3 884 B]

Получено 696 kB за 31с (22,2 kB/s)

Предварительная настройка пакетов …

Выбор ранее не выбранного пакета nginx-common.

(Чтение базы данных … на данный момент установлено 204378 файлов и каталогов.)

Подготовка к распаковке …/0-nginx-common_1.18.0-6ubuntu14.1_all.deb …

Распаковывается nginx-common (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета libnginx-mod-http-geoip2.

Подготовка к распаковке …/1-libnginx-mod-http-geoip2_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается libnginx-mod-http-geoip2 (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета libnginx-mod-http-image-filter.

Подготовка к распаковке …/2-libnginx-mod-http-image-filter_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается libnginx-mod-http-image-filter (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета libnginx-mod-http-xslt-filter.

Подготовка к распаковке …/3-libnginx-mod-http-xslt-filter_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается libnginx-mod-http-xslt-filter (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета libnginx-mod-mail.

Подготовка к распаковке …/4-libnginx-mod-mail_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается libnginx-mod-mail (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета libnginx-mod-stream.

Подготовка к распаковке …/5-libnginx-mod-stream_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается libnginx-mod-stream (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета libnginx-mod-stream-geoip2.

Подготовка к распаковке …/6-libnginx-mod-stream-geoip2_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается libnginx-mod-stream-geoip2 (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета nginx-core.

Подготовка к распаковке …/7-nginx-core_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается nginx-core (1.18.0-6ubuntu14.1) …

Выбор ранее не выбранного пакета nginx.

Подготовка к распаковке …/8-nginx_1.18.0-6ubuntu14.1_amd64.deb …

Распаковывается nginx (1.18.0-6ubuntu14.1) …

Настраивается пакет nginx-common (1.18.0-6ubuntu14.1) …

Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib/systemd/system/nginx.service.

Настраивается пакет libnginx-mod-http-xslt-filter (1.18.0-6ubuntu14.1) …

Настраивается пакет libnginx-mod-http-geoip2 (1.18.0-6ubuntu14.1) …

Настраивается пакет libnginx-mod-mail (1.18.0-6ubuntu14.1) …

Настраивается пакет libnginx-mod-http-image-filter (1.18.0-6ubuntu14.1) …

Настраивается пакет libnginx-mod-stream (1.18.0-6ubuntu14.1) …

Настраивается пакет libnginx-mod-stream-geoip2 (1.18.0-6ubuntu14.1) …

Настраивается пакет nginx-core (1.18.0-6ubuntu14.1) …

 * Upgrading binary nginx                                                                                                    [ OK ] 

Настраивается пакет nginx (1.18.0-6ubuntu14.1) …

Обрабатываются триггеры для man-db (2.10.2-1) …

Обрабатываются триггеры для ufw (0.36.1-4build1) …

alexei@alexei-VirtualBox:~$ sudo systemctl status nginx.service

● nginx.service - A high performance web server and a reverse proxy server

     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)

     Active: active (running) since Sat 2022-08-13 08:48:49 MSK; 1min 15s ago

       Docs: man:nginx(8)

    Process: 4818 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)

    Process: 4819 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=0/SUCCESS)

   Main PID: 4911 (nginx)

      Tasks: 2 (limit: 2292)

     Memory: 3.6M

        CPU: 28ms

     CGroup: /system.slice/nginx.service

             ├─4911 "nginx: master process /usr/sbin/nginx -g daemon on; master_process on;"

             └─4914 "nginx: worker process" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""



авг 13 08:48:49 alexei-VirtualBox systemd[1]: Starting A high performance web server and a reverse proxy server...

авг 13 08:48:49 alexei-VirtualBox systemd[1]: Started A high performance web server and a reverse proxy server.

alexei@alexei-VirtualBox:~$ sudo systemctl stop nginx.service

alexei@alexei-VirtualBox:~$ sudo dpkg --remove nginx

(Чтение базы данных … на данный момент установлено 204466 файлов и каталогов.)

Удаляется nginx (1.18.0-6ubuntu14.1) …

alexei@alexei-VirtualBox:~$ sudo dpkg --remove nginx-core

(Чтение базы данных … на данный момент установлено 204463 файла и каталога.)

Удаляется nginx-core (1.18.0-6ubuntu14.1) …

Обрабатываются триггеры для man-db (2.10.2-1) …

alexei@alexei-VirtualBox:~$




alexei@alexei-VirtualBox:~$ snap list

Название                   Версия            Правка  Канал            Издатель    Примечание

bare                       1.0               5       latest/stable    canonical✓  base

core20                     20220729          1593    latest/stable    canonical✓  base

firefox                    103.0.2-1         1670    latest/stable/…  mozilla✓    -

gnome-3-38-2004            0+git.891e5bc     112     latest/stable/…  canonical✓  -

gtk-common-themes          0.1-81-g442e511   1535    latest/stable/…  canonical✓  -

snap-store                 41.3-60-gfe4703a  582     latest/stable/…  canonical✓  -

snapd                      2.56.2            16292   latest/stable    canonical✓  snapd

snapd-desktop-integration  0.1               14      latest/stable/…  canonical✓  -

alexei@alexei-VirtualBox:~$ snap find opera

Название             Версия        Издатель           Примечание  Описание

opera                89.0.4447.83  opera-software✓    -           Fast, secure, easy-to-use browser

opera-beta           90.0.4480.37  opera-software✓    -           Fast and secure web browser

opera-developer      91.0.4505.0   opera-software✓    -           Fast and secure web browser

opera-proxy          1.2.3         snawoot            -           Standalone Opera VPN proxies client.

operator-builder     0.5.0         vmware-tanzu-labs  -           A Kubebuilder plugin to accelerate the development of Kubernetes operators.

contasimple          3.1.0         enriverd           -           Contasimple Desktop

office365webdesktop  0.7.1         rafgui012          -           It is a simple desktop application for Office365 of the web version for linux

devoperator          1.7.1         art-hens-teeth     classic     DevOps tools

alexei@alexei-VirtualBox:~$ sudo snap install opera

opera 89.0.4447.83 от Opera (opera-software✓) установлен

alexei@alexei-VirtualBox:~$ snap list

Название                   Версия                      Правка  Канал            Издатель         Примечание

bare                       1.0                         5       latest/stable    canonical✓       base

chromium-ffmpeg            0.1                         30      latest/stable    canonical✓       -

core18                     20220706                    2538    latest/stable    canonical✓       base

core20                     20220729                    1593    latest/stable    canonical✓       base

firefox                    103.0.2-1                   1670    latest/stable/…  mozilla✓         -

gnome-3-28-1804            3.28.0-19-g98f9e67.98f9e67  161     latest/stable    canonical✓       -

gnome-3-38-2004            0+git.891e5bc               112     latest/stable/…  canonical✓       -

gtk-common-themes          0.1-81-g442e511             1535    latest/stable/…  canonical✓       -

opera                      89.0.4447.83                189     latest/stable    opera-software✓  -

snap-store                 41.3-60-gfe4703a            582     latest/stable/…  canonical✓       -

snapd                      2.56.2                      16292   latest/stable    canonical✓       snapd

snapd-desktop-integration  0.1                         14      latest/stable/…  canonical✓       -

alexei@alexei-VirtualBox:~$ sudo snap remove opera

[sudo] пароль для alexei: 

opera удалено

alexei@alexei-VirtualBox:~$ 



alexei@alexei-VirtualBox:~$ sudo apt install iptables

Чтение списков пакетов… Готово

Построение дерева зависимостей… Готово

Чтение информации о состоянии… Готово         

Уже установлен пакет iptables самой новой версии (1.8.7-1ubuntu5).

iptables помечен как установленный вручную.

Следующие пакеты устанавливались автоматически и больше не требуются:

  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream

  libnginx-mod-stream-geoip2 nginx-common

Для их удаления используйте «sudo apt autoremove».

Обновлено 0 пакетов, установлено 0 новых пакетов, для удаления отмечено 0 пакетов, и 289 пакетов не обновлено.

alexei@alexei-VirtualBox:~$ sudo iptables -L -v

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         



Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         



Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         

alexei@alexei-VirtualBox:~$ sudo iptables -A INPUT -s 192.168.8.156 -p tcp --dport 22 -j ACCEPT

alexei@alexei-VirtualBox:~$ sudo iptables -L -v

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         

    0     0 ACCEPT     tcp  --  any    any     192.168.8.156        anywhere             tcp dpt:ssh



Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         



Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination

alexei@alexei-VirtualBox:~$ sudo iptables -A INPUT -s 192.168.8.156 -p tcp --dport 80 -j ACCEPT

alexei@alexei-VirtualBox:~$ sudo iptables -L -v

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         

    0     0 ACCEPT     tcp  --  any    any     192.168.8.156        anywhere             tcp dpt:ssh

    0     0 ACCEPT     tcp  --  any    any     192.168.8.156        anywhere             tcp dpt:http



Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         



Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)

 pkts bytes target     prot opt in     out     source               destination         

alexei@alexei-VirtualBox:~$ 

alexei@alexei-VirtualBox:~$ sudo iptables -F

alexei@alexei-VirtualBox:~$ sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080

alexei@alexei-VirtualBox:~$ sudo iptables -t nat -L

Chain PREROUTING (policy ACCEPT)

target     prot opt source               destination         

REDIRECT   tcp  --  anywhere             anywhere             tcp dpt:http redir ports 8080



Chain INPUT (policy ACCEPT)

target     prot opt source               destination         



Chain OUTPUT (policy ACCEPT)

target     prot opt source               destination         



Chain POSTROUTING (policy ACCEPT)

target     prot opt source               destination         

alexei@alexei-VirtualBox:~$